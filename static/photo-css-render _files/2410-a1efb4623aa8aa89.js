try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6c0d1e1f-0cc7-4857-b9ea-110bcfba997d",e._sentryDebugIdIdentifier="sentry-dbid-6c0d1e1f-0cc7-4857-b9ea-110bcfba997d")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2410],{72116:function(e,t,r){r.d(t,{Cg:function(){return o},hP:function(){return v},zL:function(){return p}});var n=r(6273),a=r(91115),s=r(21288);let i=new n.XMLParser({ignoreAttributes:!1,preserveOrder:!0,trimValues:!0}),o=e=>null!=e&&"object"==typeof e&&"type"in e&&"tool_use"===e.type&&"name"in e&&"data"in e&&"done"in e;a.z.object({type:a.z.literal("lov-sql"),lovSql:a.z.string(),done:a.z.boolean()}),a.z.object({type:a.z.literal("lov-mermaid"),mermaidCode:a.z.string(),done:a.z.boolean()});let l=a.z.object({type:a.z.literal("lov_action__link"),url:a.z.string(),text:a.z.string()}),u=a.z.object({type:a.z.literal("lov_action__migrate"),toolUseId:a.z.string().optional(),done:a.z.boolean()}),c=a.z.object({type:a.z.literal("lov_action__message_prompt"),message:a.z.string(),text:a.z.string()}),d=a.z.object({type:a.z.literal("lov_action__knowledge")}),g=a.z.object({type:a.z.literal("lov_action__secret_form"),name:a.z.string()}),f=a.z.object({type:a.z.literal("lov_action__user_feedback_form"),message_id:a.z.string().optional()}),m=a.z.union([l,u,c,d,g,f]);function p(e){return e.parts.filter(e=>"done"in e&&e.done&&("search_replace_parts"in e||"content"in e)).length}function v(e){let t=[],r=[],n=null,a=!1,l=!1,u=!1,c=!1,d=!1,g=!1,f=!1,p=!1,v=!1,h="",S="",b="",y="",E=null,w="",C="";function I(){var e,I,x,M,k,T,j;let P=b.trim();if("<lov-plan>"===P||"</lov-plan>"===P){b="";return}if(b.trim().startsWith("<lov-tool-use")){v=!0;let s=(y=b).match(/id="([^"]*)"/),i=y.match(/name="([^"]*)"/),o=y.match(/data="((?:[^"\\]|\\.)*)"(?=\s|\/|>)/),l=y.match(/data="(.*)$/),u=y.match(/failed="([^"]*)"/),c=(null==u?void 0:u[1])==="true",d=y.match(/duration="([^"]*)"/),g=d?Math.round(parseFloat(d[1])):void 0;if(void 0!==g&&g<=0&&(g=1),i&&n){let u=o?o[1]:l?l[1]:"",d=u?_(u):{};a&&n&&"parts"in n?n.parts.push({type:"tool_use",id:null!==(e=null==s?void 0:s[1])&&void 0!==e?e:null,name:i[1],data:u,parsedData:d,done:!1,failed:c,duration:g}):(t.push(n),t.push({type:"tool_use",id:null!==(I=null==s?void 0:s[1])&&void 0!==I?I:null,name:i[1],data:u,parsedData:d,done:!1,failed:c,duration:g}),n={type:"text",content:""}),s&&"lov-supabase-migration"===i[1]&&!r.find(e=>"lov_action__migrate"===e.type)&&r.push({type:"lov_action__migrate",done:!1,toolUseId:s[1]})}}else if(v){if(y+=b,b.includes("</lov-tool-use>")){if(v=!1,a&&n&&"parts"in n){let e=n.parts.findLastIndex(e=>"tool_use"===e.type);if(e>=0){let t=n.parts[e];if(t.done=!0,t.id&&"lov-supabase-migration"===t.name){let e=r.find(e=>"lov_action__migrate"===e.type&&e.toolUseId===t.id);e&&"lov_action__migrate"===e.type&&(e.done=!0)}}}else{let e=t.findLastIndex(e=>o(e));if(e>=0){let n=t[e];if(n.done=!0,n.id&&"lov-supabase-migration"===n.name){let e=r.find(e=>"lov_action__migrate"===e.type&&e.toolUseId===n.id);e&&"lov_action__migrate"===e.type&&(e.done=!0)}}}}}else if("<thinking>"===b.trim())a&&n&&"parts"in n?n.parts.push({type:"tool_use",id:null,name:"lov-think",data:"",parsedData:{},done:!1,failed:!1}):(n&&t.push(n),t.push({type:"tool_use",id:null,name:"lov-think",data:"",parsedData:{},done:!1,failed:!1}),n={type:"text",content:""}),f=!0,b="";else if("</thinking>"===b.trim()){let e=C.trim(),r={content:e};if(a&&n&&"parts"in n){let t=n.parts.findLastIndex(e=>"tool_use"===e.type&&"lov-think"===e.name);if(t>=0){let a=n.parts[t];a.done=!0,a.data=e,a.parsedData=r}}else{let n=t.findLastIndex(e=>o(e)&&"lov-think"===e.name);if(n>=0){let a=t[n];a.done=!0,a.data=e,a.parsedData=r}}f=!1,C="",b=""}else if("<lov-code>"===b.trim())n&&t.push(n),a=!0,n={parts:[],done:!1};else if("</lov-code>"===b.trim())n&&"done"in n&&(n.done=!0,t.push(n),n=null),a=!1;else if("<lov-sql>"===b.trim())n&&t.push(n),l=!0,n={type:"lov-sql",lovSql:"",done:!1};else if("</lov-sql>"===b.trim())n&&"lovSql"in n&&(n.done=!0,t.push(n),r.find(e=>"lov_action__migrate"===e.type)||r.push({type:"lov_action__migrate",done:!0}),n=null),l=!1;else if("<lov-mermaid>"===b.trim())n&&t.push(n),u=!0,n={type:"lov-mermaid",mermaidCode:"",done:!1};else if("</lov-mermaid>"===b.trim())n&&"mermaidCode"in n&&(n.done=!0,t.push(n),n=null),u=!1;else if(["<lov-actions>","<actions>"].includes(b.trim()))p=!0;else if(["</lov-actions>","</actions>"].includes(b.trim()))p=!1,r.push(...function(e){try{return i.parse(e).map(e=>{try{var t,r,n,a,i,o,l,u;if("lov-link"in e)return{type:"lov_action__link",url:null===(t=e[":@"])||void 0===t?void 0:t["@_url"],text:null===(n=e["lov-link"])||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r["#text"]};if("lov-knowledge"in e)return{type:"lov_action__knowledge"};if("lov-message-prompt"in e)return{type:"lov_action__message_prompt",message:null===(a=e[":@"])||void 0===a?void 0:a["@_message"],text:null===(o=e["lov-message-prompt"])||void 0===o?void 0:null===(i=o[0])||void 0===i?void 0:i["#text"]};if("lov-secret-form"in e)return{type:"lov_action__secret_form",name:null===(l=e[":@"])||void 0===l?void 0:l["@_name"]};if("lov-issue-form"in e)return{type:"lov_action__user_feedback_form",message_id:null===(u=e[":@"])||void 0===u?void 0:u["@_message_id"]};return s.logging.error("Unknown Lov action",{node:e}),null}catch(t){return s.logging.error("Error processing XML node",{error:t,node:e}),null}}).filter(e=>null!==e).reduce((e,t)=>{let r=m.safeParse(t);return r.success?e.push(r.data):s.logging.error("Failed to validate Lov action",{action:t,error:r.error}),e},[])}catch(t){return s.logging.error("Error parsing XML in parseLovActions",{error:t,input:e}),[]}}(w)),w="";else if(b.startsWith('<lov-write file_path="'))c=!0,S=(null===(x=b.match(/"([^"]*)"/))||void 0===x?void 0:x[1])||"",a&&n&&"parts"in n&&n.parts.push({type:"writing_file",file_path:S,content:"",done:!1});else if(b.startsWith('<lov-search-replace file_path="'))d=!0,S=(null===(M=b.match(/"([^"]*)"/))||void 0===M?void 0:M[1])||"",a&&n&&"parts"in n&&n.parts.push({type:"edit",file_path:S,search_replace_parts:[],done:!1});else if(b.startsWith('<lov-delete file_path="'))g=!0,S=(null===(k=b.match(/"([^"]*)"/))||void 0===k?void 0:k[1])||"",a&&n&&"parts"in n&&n.parts.push({type:"delete",file_path:S});else if(b.startsWith('<lov-rename original_file_path="')){let e=(null===(T=b.match(/original_file_path="([^"]*)"/))||void 0===T?void 0:T[1])||"",t=(null===(j=b.match(/new_file_path="([^"]*)"/))||void 0===j?void 0:j[1])||"";a&&n&&"parts"in n&&n.parts.push({type:"rename",original_file_path:e,new_file_path:t})}else if(b.startsWith("<lov-add-dependency>"))h=b.replace("<lov-add-dependency>","").replace("</lov-add-dependency>","").trim(),a&&n&&"parts"in n&&n.parts.push({type:"add_dependency",dependency:h,isDevDependency:!1});else if("</lov-add-dependency>"===b.trim())h="";else if(b.startsWith("<lov-add-dev-dependency>"))h=b.replace("<lov-add-dev-dependency>","").replace("</lov-add-dev-dependency>","").trim(),a&&n&&"parts"in n&&n.parts.push({type:"add_dependency",dependency:h,isDevDependency:!0});else if("</lov-add-dev-dependency>"===b.trim())h="";else if(b.startsWith("<lov-remove-dependency>")){let e=b.replace("<lov-remove-dependency>","").replace("</lov-remove-dependency>","").trim();a&&n&&"parts"in n&&n.parts.push({type:"remove_dependency",removed_dependency:e})}else if("</lov-remove-dependency>"===b.trim())h="";else if("</lov-write>"===b.trim()||"</lov-search-replace>"===b.trim()||"/>"===b.trim()&&g){if(c=!1,d=!1,g=!1,S="",a&&n&&"parts"in n){let e=n.parts[n.parts.length-1];"done"in e&&(e.done=!0)}}else if(a){if(v);else if(n&&"parts"in n){if(n.parts.length>0){let e=n.parts[n.parts.length-1];if(c&&"content"in e)e.content+=b;else if(d&&"search_replace_parts"in e){if("<lov-search>"===b.trim())e.search_replace_parts.push({search:"",replace:""}),E="search";else if("<lov-replace>"===b.trim())E="replace";else if("</lov-search>"===b.trim()||"</lov-replace>"===b.trim())E=null;else{let t=e.search_replace_parts[e.search_replace_parts.length-1];t&&E&&(t[E]+=b)}}else"text"===e.type&&"content"in e?e.content+=b:n.parts.push({type:"text",content:b})}else n.parts.push({type:"text",content:b})}}else l?n&&"lovSql"in n&&(n.lovSql+=b):u?n&&"mermaidCode"in n&&(n.mermaidCode+=b):p?w+=b:f?C+=b:(n&&"content"in n||(n={type:"text",content:""}),"content"in n&&(n.content+=b));b=""}let x=0;for(;x<e.length;){if(l){let t="</lov-sql>",r=e.indexOf(t,x);if(-1===r){b+=e.slice(x),x=e.length;break}b+=e.slice(x,r),I(),b=t,I(),x=r+t.length;continue}if(u){let t="</lov-mermaid>",r=e.indexOf(t,x);if(-1===r){b+=e.slice(x),x=e.length;break}b+=e.slice(x,r),I(),b=t,I(),x=r+t.length;continue}if("<"===e[x]){b&&I();let t=x,r=!1;for(;t<e.length&&!(++t>=e.length);){if('"'===e[t]){t>0&&"\\"===e[t-1]||(r=!r);continue}if(">"===e[t]&&!r)break}t<e.length?(b=e.substring(x,t+1),I(),x=t+1):(b+=e[x],x++)}else b+=e[x],x++}return b&&I(),n&&t.push(n),{parts:t,lovActions:r}}let _=e=>{let t=e.replace(/\\"/g,'"');t=t.replace(/\\\\/g,"\\");try{return JSON.parse(t)}catch(a){let e;let r={},n=/"([^"]+)":\s*(?:"([^"]*)"?|(true|false|null|\d+(?:\.\d+)?))/g;for(;null!==(e=n.exec(t));){let t=e[1],n=void 0!==e[2]?e[2]:e[3];r[t]=n}return r}}},51115:function(e,t,r){r.d(t,{Z:function(){return f}});var n=r(46214),a=r(14438),s=r(60256),i=r(74746),o=r(50126),l=r(37675),u=r(35034),c=r(21288),d=r(88746),g=r(47902);function f(){let{setIsOutOfCreditsDialogOpen:e}=(0,s.SE)(),{removeMessage:t}=(0,i.mx)(),{showErrorDialog:r}=(0,d.t)(),{setShouldShowTipsAndTricksOnDevServerStart:f}=(0,o.pE)(),{setIsSendChatMessageMutationPending:m}=(0,l.Xr)();return{handleChatStreamingError:(s,i)=>{var o,l,d,p,v;let _;let{lastUserMessageId:h,onErrorHandled:S}=i;if(t(h),"AbortError"!==s.name){if(s instanceof u.O){if(_=s.traceId,429===s.status)c.logging.error("rate_limit_exceeded",{error:s}),(0,g.rI)(),n.ZP.capture("send_chat_request_rate_limit_exceeded"),s.message.includes("We are currently under heavy load, please try again later")?a.Am.error("We are currently under heavy load, please try again later"):r(s.message,!1,_),null==S||S();else if(402===s.status)n.ZP.capture("out_of_credits_dialog_opened"),e(!0),null==S||S();else if(503===s.status)c.logging.error("send_chat_request_service_unavailable",{error:s}),r(("string"==typeof(null===(o=s.response)||void 0===o?void 0:o.details)?s.response.details:void 0)||s.message,!1,_),null==S||S();else if(499===s.status){c.logging.info("send_chat_request_client_closed",{error:s}),null==S||S();return}else s.status>=500?c.logging.error("send_chat_request_internal_error",{error:s}):c.logging.error("send_chat_request_failed",{error:s}),m(!1),f(!1),r((null===(l=s.response)||void 0===l?void 0:l.detail)||(null===(d=s.response)||void 0===d?void 0:d.details)||s.message||"Request failed",!1,_),null==S||S()}else"message"in s&&"type"in s?(c.logging.error("send_chat_request_error",{error:s}),r(s.message,!1)):(c.logging.error("send_chat_request_unknown_reason",{message:null==s?void 0:s.message,stack:null==s?void 0:s.stack,isOnline:navigator.onLine,errorType:s instanceof TypeError?"NetworkError":"ApplicationError",isNetworkError:null==s?void 0:null===(p=s.message)||void 0===p?void 0:p.includes("Failed to fetch"),isCorsError:null==s?void 0:null===(v=s.message)||void 0===v?void 0:v.includes("CORS"),isTimeout:(null==s?void 0:s.name)==="TimeoutError",isAbort:(null==s?void 0:s.name)==="AbortError",isDomException:s instanceof DOMException,error:s}),r()),null==S||S()}}}}},68904:function(e,t,r){r.d(t,{t:function(){return c}});var n=r(46214),a=r(52558),s=r(74746);let i="start-request",o="first-token",l="end-request",u="start-request";function c(){let{authUser:e}=(0,a.Eu)(),t=null==e?void 0:e.uid,{snapshot:{getUserMessageCount:r,getLastUserMessage:c}}=(0,s.mx)();return{createChatRequestPerformanceMeasurer:e=>{var a,s;let{projectId:d}=e,g=1>=r(),f=null!==(s=null===(a=c())||void 0===a?void 0:a.chatOnly)&&void 0!==s&&s,m=()=>performance.getEntriesByName(i,"mark").length>0;return{measureRequestStart:()=>{performance.mark(i)},measureTimeToFirstToken:()=>{if(!m())return;performance.mark(o);let e=performance.measure(u,i,o);n.ZP.capture("time_to_first_token",{duration:e.duration,project_id:d,user_id:t,chat_only:f,is_creation:g})},measureTimeToLastToken:()=>{if(!m())return;performance.mark(l);let e=performance.measure(u,i,l);n.ZP.capture("time_to_last_token",{duration:e.duration,project_id:d,user_id:t,chat_only:f,is_creation:g})}}}}}},92441:function(e,t,r){r.d(t,{m:function(){return i}});var n=r(2265),a=r(52558),s=r(74746);function i(){let{authUser:e}=(0,a.Eu)(),t=null==e?void 0:e.uid,{updateMessage:r}=(0,s.mx)();return{createOptimisticMessage:(0,n.useCallback)(e=>{var n,a;let{body:s}=e,i={id:s.id,createdAt:new Date,role:"user",type:"userMessage",selectedElements:null!==(n=s.selected_elements)&&void 0!==n?n:[],content:s.message,tags:null!==(a=s.tags)&&void 0!==a?a:[],images:[],containsError:!!s.contains_error,userId:t,optimistImageUrls:s.optimisticImageUrls};r(s.id,i,!1)},[r,t])}}},78079:function(e,t,r){r.d(t,{O:function(){return x},m:function(){return I}});var n=r(21770),a=r(96484),s=r(82176),i=r(21288),o=r(10531),l=r(2925),u=r(50126),c=r(90045),d=r(37675),g=r(20958),f=r(2265),m=r(22076),p=r(29328),v=r(74746),_=r(49131),h=r(51115),S=r(14438),b=r(24032),y=r(68904),E=r(92441),w=r(47176),C=r(10867);function I(e){let t=(0,g.C)();return x({...e,repoAccessibilityState:t})}function x(e){let{projectId:t,onRepoInaccessible:r,onSubmit:g,autoSwitchToCode:I=!1,onSuccess:x,repoAccessibilityState:M}=e,k=(0,s.dl)(o.P.AgentDefault),T=(0,l.u)(e=>e.currentPage),{setShouldShowTipsAndTricksOnDevServerStart:j}=(0,u.pE)(),{setIsSendChatMessageMutationPending:P}=(0,d.Xr)(),{createChatRequestPerformanceMeasurer:R}=(0,y.t)(),{createSseEventHandler:D}=function(e){let{autoSwitchToCode:t=!1}=e,{updateMessage:r,setLatestStreamedMessage:n,isMessageStopped:a}=(0,v.mx)(),{updateConsoleStateOnStreaming:s}=(0,w.k)({autoSwitchToCode:t});return{createSseEventHandler:()=>{let e="";return t=>{if("message"!==t.type){i.logging.error("received_unknown_chat_sse",{event_type:t.type,event_data:t.data});return}let o=t.data.message;if(a(o.id))return;let l={...o,stopped:!!o.stopped,status:"running"};n(l);let u=(0,C.AR)(l);u&&("aiMessage"===u.type||"userMessage"===u.type)?r(o.id,u,!0):i.logging.error("unknown_message_type",{message:o}),e=s(o,e)}}}}({autoSwitchToCode:I}),{handleChatStreamingError:O}=(0,h.Z)(),{isRepoAccessible:A,removeLatestMessageIfRepoInaccessible:L}=function(){let{restoreEditorState:e}=(0,b.WR)(),{removeMessage:t}=(0,v.mx)(),r=(0,f.useCallback)(e=>!e||(null==e?void 0:e.accessibility)==="repo_accessible"||(null==e?void 0:e.accessibility)==="repo_not_found",[]),n=r=>{let{onRepoInaccessible:n,latestMessageId:a}=r;null==n||n(),e(),S.Am.error("We couldn't access this project repository."),a&&t(a)};return{isRepoAccessible:r,removeLatestMessageIfRepoInaccessible:(e,t,a)=>{r(e)||n({onRepoInaccessible:a,latestMessageId:t})}}}(),{sendChatRequest:N}=function(){let{prepareMessageDiagnostics:e}=function(){let e=(0,m.D)(),{store:t}=(0,p.My)(),r=(0,p.f6)(e=>e.rrwebEvents),n=(0,f.useCallback)(r=>{let{runtimeErrors:n,latestBuildTimestamp:s}=e.store.getState();r.session_replay=a();let i=t.getState().consoleLogs.length,o=t.getState().networkRequests.length;r.client_logs=[...t.getState().consoleLogs.slice(Math.max(i-50,0),i)],r.network_requests=[...t.getState().networkRequests.slice(Math.max(o-50,0),o)],r.runtime_errors=[...n].filter(e=>e.timestamp>=s),e.clearDiagnostics(),t.setState(e=>{e.consoleLogs=[],e.networkRequests=[],e.rrwebEvents=[]})},[]),a=(0,f.useCallback)(()=>{let e=r.map(e=>{let t=JSON.stringify(e);return t.length>1e4?{type:e.type,timestamp:e.timestamp,data:{truncated:!0,originalSize:t.length}}:e}),t=0,n=[];for(let r=e.length-1;r>=0;r--){let a=JSON.stringify(e[r]);if(t+a.length<=1e6)n.unshift(e[r]),t+=a.length;else break}return JSON.stringify(n)},[]);return{prepareMessageDiagnostics:n}}(),{addAbortController:t,removeAbortController:r}=(0,v.mx)();return{sendChatRequest:async n=>{let{projectId:a,body:s,onStart:i,onComplete:o}=n;e(s);let l=new AbortController;t(l),null==i||i();let u=(0,_.SJ)();try{await u.postWithStreaming("/projects/".concat(a,"/chat"),s,()=>{l.abort()},l.signal)}finally{null==o||o(),r(l)}}}}(),{createOptimisticMessage:z}=(0,E.m)(),U=(0,c.hT)(e=>e.chatMode===c.jE.AGENT),{selectedModel:q}=(0,a.L6)(),F=async(e,n)=>{e.current_page=T,"enabled"!==e.agent_mode&&(e.agent_mode=U?"enabled":"disabled"),"auto"!==q&&(e.model=q),k&&(e.agent_mode="enabled");let a=n||t;if(!a){i.logging.error("Project ID is required to send chat message");return}let{measureRequestStart:s,measureTimeToFirstToken:o}=R({projectId:a});if(!A(M)){var l;L(M,null!==(l=e.id)&&void 0!==l?l:void 0,r);return}await N({projectId:a,body:e,onMessage:D(),onStart:s,onFirstEvent:o})};return(0,n.D)({mutationFn:async e=>{let{body:r,projectId:n,isCreation:a}=e;P(!0),a&&j(!0);let s=n||t;if(!s){i.logging.error("Project ID is required to send chat message");return}return F(r,s)},onMutate:e=>{let{body:t,clear:r}=e;z({body:t}),null==g||g(t.message),null==r||r()},onSuccess:()=>{null==x||x()},onError:(e,t)=>{let{body:r,restore:n}=t;return O(e,{lastUserMessageId:r.id,onErrorHandled:n})}})}},47902:function(e,t,r){r.d(t,{Y:function(){return c},ZK:function(){return s},_g:function(){return d},rI:function(){return o}});var n=r(66491),a=r(5978);let s=e=>{if(!e)return!0;let t=e instanceof a.EK?e.toDate():new Date(e);return(new Date().getTime()-t.getTime())/36e5>=24},i="lovable_rate_limit_timestamp",o=()=>{let e=Date.now();localStorage.setItem(i,e.toString())},l=()=>{let e=localStorage.getItem(i);return e?parseInt(e,10):null},u=()=>{localStorage.removeItem(i)},c=()=>{let e=l();if(!e)return{isRateLimited:!1,secondsRemaining:0};let t=Math.max(0,60-Math.floor((Date.now()-e)/1e3));return 0===t?(u(),{isRateLimited:!1,secondsRemaining:0}):{isRateLimited:!0,secondsRemaining:t}},d=e=>{let t=new Date,r=Math.floor((t.getTime()-e.getTime())/1e3);if(r<60)return"Just now";let a=Math.floor(r/60);if(a<60)return"".concat(a,"m ago");let s=Math.floor(a/60);return s<24?"".concat(s,"h ago"):e.getFullYear()===t.getFullYear()?(0,n.WU)(e,"hh:mm 'on' MMM dd"):(0,n.WU)(e,"hh:mm 'on' MMM dd yyyy")}},88746:function(e,t,r){r.d(t,{Y:function(){return g},t:function(){return d}});var n=r(57437),a=r(46214),s=r(2265),i=r(59625),o=r(62869),l=r(26110),u=r(57346),c=r(67817);let d=(0,i.Ue)(e=>({open:!1,errorMessage:null,showTryAgain:!0,traceId:null,showErrorDialog:function(t){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2?arguments[2]:void 0;return a.ZP.capture("error_dialog_shown",{error_message:t,show_try_again:r,trace_id:n}),e({open:!0,errorMessage:t,showTryAgain:r,traceId:n})},closeError:()=>e({open:!1,errorMessage:null,showTryAgain:!0,traceId:null})}));function g(){let{open:e,errorMessage:t,closeError:r,showTryAgain:i,traceId:g}=d(),[f,m]=(0,s.useState)(!1),p=(0,c.v)(),v=async()=>{if(g)try{await navigator.clipboard.writeText(g),m(!0),setTimeout(()=>m(!1),2e3)}catch(e){console.error("Failed to copy trace ID: ",e)}},_=()=>g?"https://lovable.grafana.net/a/grafana-exploretraces-app/explore?from=now-24h&to=now&timezone=browser&var-ds=grafanacloud-traces&var-primarySignal=nestedSetParent%3C0&var-filters=&var-metric=rate&var-groupBy=resource.service.name&var-spanListColumns=&var-latencyThreshold=&var-partialLatencyThreshold=&actionView=breakdown&traceId=".concat(g):"";return(0,n.jsx)(l.Vq,{open:e,onOpenChange:e=>{e||(a.ZP.capture("error_dialog_closed",{action:"backdrop",error_message:t,trace_id:g}),r())},children:(0,n.jsxs)(l.cZ,{children:[(0,n.jsxs)(l.fK,{className:"text-left",children:[(0,n.jsx)(l.$N,{className:"text-left",children:"Error"}),(0,n.jsxs)(l.Be,{className:"flex flex-col items-start",children:[(t||"An unexpected error occurred. ").split("\n").map((e,r)=>(0,n.jsxs)("span",{children:[e,r!==(t||"An unexpected error occurred. ").split("\n").length-1&&(0,n.jsx)("br",{})]},r)),i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:"Please try again later."})]}),g&&(0,n.jsx)("div",{className:"mt-2 w-full text-[10px] text-muted-foreground/70",children:(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-1",children:[(0,n.jsx)("p",{children:"ID:"}),(0,n.jsx)("code",{className:"relative break-all rounded bg-muted/50 px-[0.2rem] font-mono",children:g}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(o.z,{variant:"link",size:"icon-xs",className:"p-0 text-muted-foreground/70 hover:text-muted-foreground focus:ring-0 focus-visible:ring-0 focus-visible:ring-offset-0",onClick:v,"aria-label":"Copy Trace ID",tabIndex:-1,children:(0,n.jsx)(u.Z,{name:f?"check":"content_copy",size:"small"})}),p&&(0,n.jsx)(o.z,{variant:"link",size:"icon-xs",className:"p-0 text-muted-foreground/70 hover:text-muted-foreground focus:ring-0 focus-visible:ring-0 focus-visible:ring-offset-0",onClick:()=>window.open(_(),"_blank"),"aria-label":"View in Grafana",tabIndex:-1,children:(0,n.jsx)(u.Z,{name:"monitoring",size:"small"})})]})]})})]})]}),(0,n.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:(0,n.jsxs)(l.cN,{className:"flex flex-row justify-end gap-2",children:[(0,n.jsx)(o.z,{variant:"outline",onClick:()=>{a.ZP.capture("error_dialog_closed",{action:"get_help",error_message:t,trace_id:g}),r(),window.open("https://docs.lovable.dev/#stay-connected","_blank")},children:"Get help"}),(0,n.jsx)(o.z,{onClick:()=>{a.ZP.capture("error_dialog_closed",{action:"ok",error_message:t,trace_id:g}),r()},autoFocus:!0,children:"Dismiss"})]})})]})})}},26237:function(e,t,r){r.d(t,{C:function(){return i}});var n=r(2265),a=r(77113);let s=e=>{try{if(null==e)return!1;let t=e.toDate();if(new Date().getTime()-t.getTime()>6e4)return!1;return!0}catch(e){return!1}},i=()=>{let e=(0,a.iZ)(e=>e.project),t=null==e?void 0:e.locked_at,[r,i]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!t||!s(t)){i(!1);return}let e=setInterval(()=>{let r=s(t);i(r),r||clearInterval(e)},250);return()=>clearInterval(e)},[t]),r}},2925:function(e,t,r){r.d(t,{u:function(){return n}});let n=(0,r(59625).Ue)(e=>({currentPage:"index",setCurrentPage:t=>e({currentPage:t})}))},47176:function(e,t,r){r.d(t,{k:function(){return i}});var n=r(50126),a=r(72116),s=r(29328);function i(e){let{autoSwitchToCode:t=!1}=e,r=(0,n.Sl)(e=>e.consoleContentType),{store:i,setActiveMessageId:o,setShowConsole:l,setConsoleCodeContent:u,exitConsole:c}=(0,n.pE)(),{store:d}=(0,s.My)(),g=(e,r)=>(e.content.includes("</lov-code>")&&!r.includes("</lov-code>")?(c(),d.setState(e=>{e.consoleLogs=[],e.rrwebEvents=[]})):e.content.includes("<lov-code>")&&!r.includes("<lov-code>")&&t&&(l("code"),e.id&&o(e.id)),r),f=(e,t)=>{if(!e.content)return t;let r=i.getState().activeMessageId;if(e.id===r){for(let t of(0,a.hP)(e.content).parts)if("parts"in t)return u(t),e.content}return t};return{consoleContentType:r,updateConsoleStateOnStreaming:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=t;return r=g(e,r),r=f(e,r)}}}},74746:function(e,t,r){r.d(t,{ei:function(){return f},aM:function(){return x},mx:function(){return M},aK:function(){return k},tV:function(){return T},uO:function(){return j},iY:function(){return R},IE:function(){return P},Fm:function(){return D}});var n=r(57437),a=r(2265),s=r(2043),i=r(37675),o=r(5978),l=r(78099);function u(e){let{array:t,batchSize:r}=e;return Array.from({length:Math.ceil(t.length/r)},(e,n)=>t.slice(n*r,(n+1)*r))}var c=r(21288);let d=e=>{let t={};return e.forEach((e,r)=>{var n,a,s,i,o,l,u,c,d;let g=e.data(),f={id:g.id,commit_sha:null!==(n=g.commit_sha)&&void 0!==n?n:"unknown",commit_message:null!==(a=g.commit_message)&&void 0!==a?a:"unknown",created_at:g.created_at,reverted:null!==(s=g.reverted)&&void 0!==s&&s,type:g.type,diff:null!==(i=g.diff)&&void 0!==i?i:null,status:null!==(o=g.status)&&void 0!==o?o:null,previewBuildStatus:null!==(l=g.preview_build_status)&&void 0!==l?l:null,bookmarked:null!==(u=g.bookmarked)&&void 0!==u&&u,revert_target_edit_id:null!==(c=g.revert_target_edit_id)&&void 0!==c?c:void 0,pages:null!==(d=g.pages)&&void 0!==d?d:[]};t[f.id]=f}),t};var g=r(10867);let f={FIRESTORE_BATCH_SIZE:30,COOLDOWN_TIME_MS:300,MESSAGES_PAGE_SIZE:30,EDIT_PAGE_SIZE:30};var m=r(10418),p=r(59625),v=r(14884);(0,m.MD)();let _=()=>(0,p.Ue)()((0,v.n)(e=>({sortedMessageIds:[],messages:{},edits:{},selectedImageUrl:void 0,imageUrlCache:{},loadingMessagesStatus:"idle",loadingEditsStatus:"idle",isInitialized:!1,hasOlderMessages:!0,hasOlderEdits:!0,canLoadMoreMessages:!0,canLoadMoreEdits:!0,stoppedMessageIds:new Set,latestStreamedMessage:void 0,abortControllers:[]})));function h(e,t){var r;return null!==(r=Object.values(e.messages).find(e=>"aiMessage"===e.type&&e.editId===t))&&void 0!==r?r:null}function S(e,t){var r;return null!==(r=Object.values(e.messages).find(e=>"userCommit"===e.type&&e.shortCommitHash===t))&&void 0!==r?r:null}function b(e,t){return Object.values(e.edits).find(e=>e.commit_sha.startsWith(t))||null}function y(e){var t,r;return null!==(r=null===(t=Object.values(e.edits).sort((e,t)=>{let r=e.created_at.toDate().getTime();return t.created_at.toDate().getTime()-r}).find(e=>!!e.pages&&!!e.pages.length))||void 0===t?void 0:t.pages)&&void 0!==r?r:null}function E(e){let{messages:t,sortedMessageIds:r}=e;for(let e=r.length-1;e>=0;e--){var n;let a=r[e];if((null===(n=t[a])||void 0===n?void 0:n.type)==="userMessage")return t[a]}return null}var w=r(96771),C=r(74541);let I=(0,a.createContext)(null),x=e=>{let{projectId:t,messageId:r,children:m}=e,p=(0,a.useRef)(_()),v=function(e){let{projectId:t}=e;return(0,a.useMemo)(()=>(0,o.IO)((0,o.hJ)(l.db,"projects",t,"trajectory"),(0,o.Xo)("created_at","desc")),[t])}({projectId:t}),y=function(e){let{projectId:t}=e;return(0,a.useMemo)(()=>(0,o.IO)((0,o.hJ)(l.db,"projects",t,"edits"),(0,o.ar)("type","in",[w.I.type.MANUAL_UPDATE,w.I.type.AI_UPDATE,w.I.type.DEVELOPER_UPDATE,w.I.type.REVERT]),(0,o.Xo)("created_at","desc")),[t])}({projectId:t}),x=function(e){let{projectId:t,messageId:r}=e;return(0,a.useMemo)(()=>r?(0,o.JU)(l.db,"projects",t,"trajectory",r):null,[t,r])}({projectId:t,messageId:r}),{updateMessage:M,removeMessage:k,isMostRecentMessage:T,getMessageByEditId:j,getUserCommitMessageByShortCommitHash:P,getUserMessageCount:R,getLastUserMessage:D}=function(e){let{storeRef:t}=e,r=(0,a.useCallback)((e,r,n)=>{t.current.getState().isInitialized&&t.current.setState(t=>{let a=t.messages[e],s=a&&n?{...a,..."ai"===r.role?{thinkingTimeMs:r.thinkingTimeMs}:{},content:r.content}:r,i=n?[...t.sortedMessageIds.filter(e=>e!==r.id),e]:t.sortedMessageIds;return{messages:{...t.messages,[e]:s},sortedMessageIds:i}})},[t]),n=(0,a.useCallback)(e=>{t.current.setState(t=>{let{[e]:r,...n}=t.messages;return{messages:n,sortedMessageIds:t.sortedMessageIds.filter(t=>t!==e)}})},[t]),s=(0,a.useCallback)(e=>{let r=t.current.getState().sortedMessageIds;return r[r.length-1]===e},[t]),i=(0,a.useCallback)(e=>h(t.current.getState(),e),[t]);return{updateMessage:r,removeMessage:n,isMostRecentMessage:s,getMessageByEditId:i,getUserCommitMessageByShortCommitHash:(0,a.useCallback)(e=>S(t.current.getState(),e),[t]),getUserMessageCount:(0,a.useCallback)(()=>Object.values(t.current.getState().messages).filter(e=>"userMessage"===e.type).length,[t]),getLastUserMessage:(0,a.useCallback)(()=>E(t.current.getState()),[t])}}({storeRef:p}),{loadEarlierMessages:O,loadMessagesFromId:A,earliestMessageDocRef:L,processMessagesWithEdits:N}=function(e){let{storeRef:t,projectId:r,messagesQuery:n}=e,s=(0,a.useRef)(null),i=(0,a.useCallback)(async e=>{if(0===e.length)return{};let t=u({array:e,batchSize:f.FIRESTORE_BATCH_SIZE});return(await Promise.all(t.map(async e=>d((await (0,o.PL)((0,o.IO)((0,o.hJ)(l.db,"projects",r,"edits"),(0,o.ar)("id","in",e)))).docs)))).reduce((e,t)=>({...e,...t}),{})},[r]),m=(0,a.useCallback)(async(e,t)=>{let r=(0,g.Oh)(e,t),n=e.map(e=>e.data().edit_id).filter(e=>!!e);return{messages:r,edits:await i(n)}},[i]),p=(0,a.useCallback)((e,r)=>{let{messages:n,edits:a}=r,i=e.map(e=>e.id);t.current.setState(e=>({messages:{...e.messages,...n},edits:{...e.edits,...a},sortedMessageIds:[...i,...e.sortedMessageIds]})),e.length>0&&(s.current=e[0])},[t]),v=(0,a.useCallback)(async()=>{let e=t.current.getState();if(s.current&&e.canLoadMoreMessages){t.current.setState({loadingMessagesStatus:"loading",canLoadMoreMessages:!1});try{let e=(await (0,o.PL)((0,o.IO)(n,(0,o.TQ)(s.current),(0,o.b9)(f.MESSAGES_PAGE_SIZE)))).docs.reverse();if(e.length>0){s.current=e[0];let r=await m(e,{persisted:!0});t.current.setState(t=>({messages:{...t.messages,...r.messages},edits:{...t.edits,...r.edits},hasOlderMessages:e.length>=f.MESSAGES_PAGE_SIZE,sortedMessageIds:[...e.map(e=>e.id),...t.sortedMessageIds]}))}else t.current.setState({hasOlderMessages:!1});t.current.setState({loadingMessagesStatus:"success"})}catch(e){t.current.setState({loadingMessagesStatus:"error"}),c.logging.warn("Firestore error - useMessageDataFetching - loadEarlierMessages",{error:e})}finally{setTimeout(()=>{t.current.setState({canLoadMoreMessages:!0})},f.COOLDOWN_TIME_MS)}}},[n,t,m]),_=(0,a.useCallback)((e,r)=>{let n=t.current.getState();return"message_id"===r?n.messages[e]:"shortCommitHash"===r?S(n,e):h(n,e)},[t]),b=(0,a.useCallback)(async e=>{let t=(0,o.IO)(n,(0,o.Lx)(s.current||void 0),(0,o.b9)(1e3)),r=(await (0,o.PL)(t)).docs.reverse(),a=await m(r,{persisted:!0});p(r,a)},[n,m,p]),y=(0,a.useCallback)(async(e,t)=>{let r=(0,o.IO)(n,(0,o.ar)("message_id"===t?"id":"edit_id","==",e),..."message_id"===t?[(0,o.b9)(1)]:[]),a=await (0,o.PL)(r);if(!a.docs[0])return;let i="message_id"===t?a.docs[0]:a.docs.find(e=>e.data().tag===C.r.tag.INSTANT_MODE_MESSAGE);if(!i)return;let l=(0,o.IO)(n,(0,o.Lx)(i),(0,o.TQ)(s.current||void 0)),u=[i,...(await (0,o.PL)(l)).docs.reverse()],c=await m(u,{persisted:!0});p(u,c)},[n,m,p]);return{fetchEditsForMessages:i,processMessagesWithEdits:m,loadEarlierMessages:v,loadMessagesFromId:(0,a.useCallback)(async e=>{let{messageId:r,id_type:n="edit_id"}=e,a=_(r,n),s=t.current.getState();if(!(a&&s.sortedMessageIds.includes(a.id))){t.current.setState({loadingMessagesStatus:"loading"});try{"shortCommitHash"===n?await b(r):await y(r,n),t.current.setState({loadingMessagesStatus:"success"})}catch(e){t.current.setState({loadingMessagesStatus:"error"}),console.error("Error loading messages from ID",{error:e,messageId:r,id_type:n})}}},[_,b,y,t]),earliestMessageDocRef:s}}({storeRef:p,projectId:t,messagesQuery:v}),{loadEarlierEdits:z,earliestEditDocRef:U,fetchMessagesForEdits:q}=function(e){let{storeRef:t,projectId:r,editsQuery:n}=e,s=(0,a.useRef)(null),i=(0,a.useCallback)(async e=>{if(0===e.length)return{};let t=u({array:e,batchSize:f.FIRESTORE_BATCH_SIZE});return(await Promise.all(t.map(async e=>{let t=await (0,o.PL)((0,o.IO)((0,o.hJ)(l.db,"projects",r,"trajectory"),(0,o.ar)("edit_id","in",e)));return(0,g.Oh)(t.docs,{persisted:!0})}))).reduce((e,t)=>({...e,...t}),{})},[r]);return{loadEarlierEdits:(0,a.useCallback)(async()=>{if(s.current&&t.current.getState().canLoadMoreEdits){t.current.setState({loadingEditsStatus:"loading",canLoadMoreEdits:!1});try{let e=(await (0,o.PL)((0,o.IO)(n,(0,o.TQ)(s.current),(0,o.b9)(f.EDIT_PAGE_SIZE)))).docs;if(e.length>0){s.current=e[e.length-1];let r=d(e),n=Object.keys(r),a=await i(n);t.current.setState(t=>({edits:{...t.edits,...r},messages:{...t.messages,...a},hasOlderEdits:e.length>=f.EDIT_PAGE_SIZE}))}else t.current.setState({hasOlderEdits:!1});t.current.setState({loadingEditsStatus:"success"})}catch(e){t.current.setState({loadingEditsStatus:"error"}),c.logging.warn("Firestore error - useEditOperations - loadEarlierEdits",{error:e})}finally{setTimeout(()=>{t.current.setState({canLoadMoreEdits:!0})},f.COOLDOWN_TIME_MS)}}},[n,t,i]),earliestEditDocRef:s,fetchMessagesForEdits:i}}({storeRef:p,projectId:t,editsQuery:y}),{getEditByShortCommitHash:F,updateEdit:Z}=function(e){let{storeRef:t}=e;return{getEditByShortCommitHash:(0,a.useCallback)(e=>b(t.current.getState(),e),[t]),updateEdit:(0,a.useCallback)((e,r)=>{t.current.setState(t=>{if(t.edits[e]){let n={...t.edits};return n[e]={...n[e],...r},{edits:n}}return t})},[t])}}({storeRef:p}),{cacheImageUrl:W,setSelectedImageUrl:B}=function(e){let{storeRef:t}=e;return{cacheImageUrl:(0,a.useCallback)((e,r)=>{t.current.setState(t=>({imageUrlCache:{...t.imageUrlCache,[e]:r}}))},[t]),setSelectedImageUrl:(0,a.useCallback)(e=>{t.current.setState({selectedImageUrl:e})},[t])}}({storeRef:p}),{subscriptionBoundaryTime:V}=function(e){let{storeRef:t,messagesQuery:r,editsQuery:n,processMessagesWithEdits:s}=e,i=(0,a.useRef)(o.EK.now());return(0,a.useEffect)(()=>{let e=t.current,a=(0,o.cf)((0,o.IO)(r,(0,o.ar)("created_at",">=",i.current)),async t=>{let r=[...t.docs].reverse(),n=(0,g.Oh)(r,{persisted:!0});e.setState(e=>{let t=new Set(e.sortedMessageIds),a=r.map(e=>e.id).filter(e=>!t.has(e));return{messages:{...e.messages,...n},sortedMessageIds:[...e.sortedMessageIds,...a]}})}),s=(0,o.cf)((0,o.IO)(n,(0,o.ar)("created_at",">=",i.current)),t=>{let r=d([...t.docs]);e.setState(e=>({...e,edits:{...e.edits,...r}}))});return()=>{a(),s()}},[r,n,t,s]),{subscriptionBoundaryTime:i}}({storeRef:p,messagesQuery:v,editsQuery:y,processMessagesWithEdits:N}),{loadInitialData:G}=function(e){let{storeRef:t,messagesQuery:r,editsQuery:n,subscriptionBoundaryTime:s,earliestMessageDocRef:i,earliestEditDocRef:l,processMessagesWithEdits:u,fetchMessagesForEdits:c,messageId:g,specificMessageQuery:m}=e;return{loadInitialData:(0,a.useCallback)(async()=>{let e;if(g&&m){let t=await (0,o.QT)(m);e=t.exists()?await (0,o.PL)((0,o.IO)(r,(0,o.ar)("created_at","<",s.current),(0,o.Wu)(t))):await (0,o.PL)((0,o.IO)(r,(0,o.ar)("created_at","<",s.current),(0,o.b9)(f.MESSAGES_PAGE_SIZE)))}else e=await (0,o.PL)((0,o.IO)(r,(0,o.ar)("created_at","<",s.current),(0,o.b9)(f.MESSAGES_PAGE_SIZE)));let a=e.docs.reverse();a.length>0&&(i.current=a[0]);let{messages:p,edits:v}=await u(a,{persisted:!0}),_=await (0,o.PL)((0,o.IO)(n,(0,o.ar)("created_at","<",s.current),(0,o.b9)(f.EDIT_PAGE_SIZE)));_.docs.length>0&&(l.current=_.docs[_.docs.length-1]);let h=d(_.docs),S=d((await (0,o.PL)((0,o.IO)(n,(0,o.ar)("bookmarked","==",!0)))).docs),b=Object.keys(S),y={};b.length>0&&(y=await c(b)),t.current.setState(t=>{let r={...t.messages,...p,...y},n=[...new Set([...t.sortedMessageIds,...a.map(e=>e.id)])];return n=n.sort((e,t)=>{let n=r[e],a=r[t];return n.createdAt.getTime()-a.createdAt.getTime()}),{messages:r,hasOlderMessages:e.docs.length>=f.MESSAGES_PAGE_SIZE,edits:{...t.edits,...v,...h,...S},hasOlderEdits:_.docs.length>=f.EDIT_PAGE_SIZE,sortedMessageIds:n,isInitialized:!0}})},[r,n,s,i,l,u,c,t,g,m])}}({storeRef:p,messagesQuery:v,editsQuery:y,subscriptionBoundaryTime:V,earliestMessageDocRef:L,earliestEditDocRef:U,processMessagesWithEdits:N,fetchMessagesForEdits:q,messageId:r,specificMessageQuery:x}),{setLatestStreamedMessage:H,addStoppedMessageId:J,isMessageStopped:K,addAbortController:X,removeAbortController:Y}=function(e){let{storeRef:t}=e;return{setLatestStreamedMessage:e=>{t.current.setState(t=>({...t,latestStreamedMessage:e}))},addStoppedMessageId:e=>{e&&t.current.setState(t=>({...t,stoppedMessageIds:new Set([...t.stoppedMessageIds,e])}))},isMessageStopped:e=>{let r=t.current.getState();return!!r.latestStreamedMessage&&"stopped"in r.latestStreamedMessage&&!!r.latestStreamedMessage.stopped||r.stoppedMessageIds.has(e)},addAbortController:e=>{t.current.setState(t=>({...t,abortControllers:[...t.abortControllers,e]}))},removeAbortController:e=>{t.current.setState(t=>({...t,abortControllers:t.abortControllers.filter(t=>t!==e)}))}}}({storeRef:p}),{setIsSendChatMessageMutationPending:$}=(0,i.Xr)(),{canEdit:Q}=(0,s.t)();(0,a.useEffect)(()=>{Q&&G()},[G,Q]);let ee={store:p.current,updateMessage:M,removeMessage:k,loadEarlierMessages:O,loadMessagesFromId:A,loadEarlierEdits:z,cacheImageUrl:W,setSelectedImageUrl:B,isMostRecentMessage:T,updateEdit:Z,setLatestStreamedMessage:H,addStoppedMessageId:J,isMessageStopped:K,addAbortController:X,removeAbortController:Y,abortRequests:()=>{$(!1),p.current.getState().abortControllers.forEach(e=>{e.abort()}),p.current.setState(e=>({...e,abortControllers:[]}))},snapshot:{getEditByShortCommitHash:F,getMessageByEditId:j,getUserCommitMessageByShortCommitHash:P,getUserMessageCount:R,getLastUserMessage:D}};return(0,n.jsx)(I.Provider,{value:ee,children:m})};function M(){let e=(0,a.useContext)(I);if(!e)throw Error("useChatContext must be used within a ChatProvider");return e}function k(e){let t=M();if(!t)throw Error("useChatStore must be used within a ChatProvider");return t.store(e)}function T(e){return k(t=>e?t.edits[e]:null)}function j(e){return k(t=>e?b(t,e):null)}function P(){return k(y)}function R(){return k(E)}function D(e){return k(t=>e?h(t,e):null)}},7455:function(e,t,r){r.d(t,{c:function(){return f},h:function(){return g}});var n=r(57437),a=r(92850),s=r(2265),i=r(59625),o=r(52558),l=r(33187),u=r(77113);let c=()=>(0,i.Ue)(()=>({collaborators:[],accessLevel:null,collaboratorsInitialized:!1,hasFetchedCollaborators:!1})),d=(0,s.createContext)(null),g=e=>{let{children:t,projectId:r}=e,i=(0,s.useRef)(c()),{authUser:g}=(0,o.Eu)(),f=(0,u.iZ)(e=>e.project),{data:m,isFetched:p}=(0,a.a)(l.W.collaborators({projectId:r,projectOwnerId:null==f?void 0:f.user_id}));(0,s.useEffect)(()=>{if(m&&(null==f?void 0:f.user_id)){let e=(0,l.b)({collaborators:m,projectOwnerId:f.user_id});i.current.setState({collaborators:e})}},[m,null==f?void 0:f.user_id]),(0,s.useEffect)(()=>{if(null==g?void 0:g.uid){let e=null==m?void 0:m.find(e=>e.id===(null==g?void 0:g.uid));e&&e.joined_at?i.current.setState({accessLevel:e.access_level}):i.current.setState({accessLevel:null})}},[null==g?void 0:g.uid,m]),(0,s.useEffect)(()=>{p&&i.current.setState({hasFetchedCollaborators:!0})},[p]);let v={store:i.current};return(0,n.jsx)(d.Provider,{value:v,children:t})};function f(e){let{store:t}=function(){let e=(0,s.useContext)(d);if(!e)throw Error("useCollaborationContext must be used within a CollaborationProvider");return e}();return t(e)}},50126:function(e,t,r){r.d(t,{BV:function(){return c},Sl:function(){return g},pE:function(){return d},vD:function(){return o}});var n=r(57437),a=r(2265),s=r(59625),i=r(40878);let o={error:"Error",code:"Code",debug:"Debug",annotation:"Annotation","snapshot-preview":"Snapshot Preview",mermaid:"Mermaid Diagram"},l=()=>(0,s.Ue)(()=>({activeView:"preview",consoleContentType:null,activeMessageId:void 0,activeEditId:void 0,activeConsoleCodeContent:void 0,activeConsoleErrorContent:void 0,activeConsolePreviewContent:void 0,activeConsoleMermaidContent:void 0,shouldShowTipsAndTricksOnDevServerStart:!1})),u=(0,a.createContext)(null),c=e=>{let{children:t}=e,r=(0,a.useRef)(l()),{setIsPreviewDocked:s,setView:o}=(0,i.zp)(),c={store:r.current,setActiveView:e=>{r.current.setState({activeView:e})},setShowConsole:e=>{let t=r.current;"snapshot-preview"!==e&&null!==e&&s(!0),t.setState({consoleContentType:e,activeView:e?"console":"preview"}),o(e?i.$.PREVIEW:i.$.CHAT)},setConsoleContentType:e=>{let t=r.current;t.setState({consoleContentType:e,activeView:e?"console":t.getState().activeView})},setActiveMessageId:e=>{r.current.setState({activeMessageId:e})},setActiveEditId:e=>{r.current.setState({activeEditId:e})},setConsoleCodeContent:e=>{r.current.setState({activeConsoleCodeContent:e})},setConsoleErrorContent:e=>{r.current.setState({activeConsoleErrorContent:e})},setConsolePreviewContent:e=>{r.current.setState({activeConsolePreviewContent:e})},setActiveMermaidContent:e=>{r.current.setState({activeConsoleMermaidContent:e})},setShouldShowTipsAndTricksOnDevServerStart:e=>{r.current.setState({shouldShowTipsAndTricksOnDevServerStart:e})},exitConsole:()=>{r.current.setState({consoleContentType:null,activeView:"preview",activeMessageId:void 0,activeEditId:void 0,activeConsoleErrorContent:void 0,activeConsoleCodeContent:void 0,activeConsolePreviewContent:void 0,activeConsoleMermaidContent:void 0,shouldShowTipsAndTricksOnDevServerStart:!1}),o(i.$.CHAT)}};return(0,n.jsx)(u.Provider,{value:c,children:t})};function d(){let e=(0,a.useContext)(u);if(!e)throw Error("useConsoleContext must be used within a ConsoleProvider");return e}function g(e){let{store:t}=d();return t(e)}},37675:function(e,t,r){r.d(t,{Xr:function(){return c},bk:function(){return d},pY:function(){return g},vw:function(){return u}});var n=r(57437),a=r(2265),s=r(59625),i=r(14884);let o=()=>(0,s.Ue)()((0,i.n)(e=>({isSendChatMessageMutationPending:!1,isBuildErrorOccurredDuringStream:!1,isSomeRevertMutationPending:!1,editIdToConfirmRestoreFor:void 0}))),l=(0,a.createContext)(null),u=e=>{let{children:t}=e,r=(0,a.useRef)(o()),s={store:r.current,setIsSendChatMessageMutationPending:e=>{r.current.setState({isSendChatMessageMutationPending:e,isBuildErrorOccurredDuringStream:!1})},setIsBuildErrorOccurredDuringStream:e=>{r.current.setState({isBuildErrorOccurredDuringStream:e})},setIsSomeRevertMutationPending:e=>{r.current.setState({isSomeRevertMutationPending:e})},setEditIdToConfirmRestoreFor:e=>{r.current.setState({editIdToConfirmRestoreFor:e})}};return(0,n.jsx)(l.Provider,{value:s,children:t})};function c(){let e=(0,a.useContext)(l);if(!e)throw Error("useMessageSubmissionContext must be used within a MessageSubmissionProvider");return e}function d(e){let{store:t}=c();return t(e)}let g=()=>{let{isSendChatMessageMutationPending:e,isSomeRevertMutationPending:t}=d(e=>e);return e||t}},40878:function(e,t,r){r.d(t,{$:function(){return a},eP:function(){return c},gu:function(){return g},zp:function(){return d}});var n,a,s=r(57437),i=r(2265),o=r(59625);(n=a||(a={})).PREVIEW="preview",n.CHAT="chat";let l=()=>(0,o.Ue)(()=>({view:"chat",isPreviewDocked:!0,showHistoryPanel:!1})),u=(0,i.createContext)(null),c=e=>{let{children:t}=e,r=(0,i.useRef)(l()),n={store:r.current,setView:e=>{let t=r.current;"function"==typeof e?t.setState(t=>({view:e(t.view)})):t.setState({view:e})},setIsPreviewDocked:e=>{let t=r.current;"function"==typeof e?t.setState(t=>({isPreviewDocked:e(t.isPreviewDocked)})):t.setState({isPreviewDocked:e})}};return(0,s.jsx)(u.Provider,{value:n,children:t})};function d(){let e=(0,i.useContext)(u);if(!e)throw Error("useMobileContext must be used within a MobileProvider");return e}function g(e){let{store:t}=d();return t(e)}},29328:function(e,t,r){r.d(t,{i5:function(){return J},wF:function(){return P},g9:function(){return H},XE:function(){return V},My:function(){return R},f6:function(){return D},vE:function(){return O}});var n=r(57437),a=r(92850),s=r(53974),i=r(2265),o=r(14273),l=r(59625),u=r(14884),c=r(88568),d=r(21288);let g=e=>{var t,r,n,a,s,i,o,l;let u=Object.entries(e.headers||{}).reduce((e,t)=>{let[r,n]=t;return e+r.length+String(n).length},0);return((null===(t=e.responseBody)||void 0===t?void 0:t.length)||0)+((null===(r=e.requestBody)||void 0===r?void 0:r.length)||0)+((null===(a=e.error)||void 0===a?void 0:null===(n=a.message)||void 0===n?void 0:n.length)||0)+((null===(i=e.error)||void 0===i?void 0:null===(s=i.stack)||void 0===s?void 0:s.length)||0)+((null===(o=e.url)||void 0===o?void 0:o.length)||0)+((null===(l=e.statusText)||void 0===l?void 0:l.length)||0)+u},f=e=>e.reduce((e,t)=>e+t.message.length,0);var m=r(98015),p=r(65666),v=r(49131),_=r(76906),h=r(22076),S=r(61062),b=r(7163),y=r(48614),E=r(1188),w=e=>{let{isLoading:t}=e,[r,a]=(0,i.useState)(0),[s,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{t&&(a(0),o(!0))},[t]),(0,i.useEffect)(()=>{if(!t){a(100);return}let e=[];return[{duration:150,increment:15},{duration:250,increment:10},{duration:400,increment:5},{duration:500,increment:3},{duration:650,increment:3},{duration:750,increment:3},{duration:1500,increment:2},{duration:2e3,increment:1},{duration:3e3,increment:1},{duration:4e3,increment:1},{duration:5e3,increment:1},{duration:6e3,increment:1},{duration:7e3,increment:1},{duration:1e4,increment:1},{duration:14e3,increment:1}].forEach(t=>{let{duration:r,increment:n}=t,s=setTimeout(()=>{a(e=>e<75?e+n+2*Math.random():e)},r);e.push(s)}),()=>{e.forEach(e=>clearTimeout(e))}},[t]),(0,n.jsx)("div",{className:"pointer-events-none absolute left-0 right-0 top-0 h-[3px] w-full overflow-hidden bg-transparent",children:(0,n.jsx)(y.M,{children:s&&(0,n.jsx)(E.E.div,{className:"h-full bg-accent",initial:{width:0,opacity:1},animate:{width:"".concat(Math.min(r,100),"%"),opacity:1},exit:{opacity:0,transition:{delay:.2,duration:.3}},transition:{width:{duration:.15,bounce:0}},onAnimationComplete:()=>{t||o(!1)}})})})};function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";try{let r=new URL(e);return t.useCustomScript&&r.searchParams.set("lov-override-script","true"),t.accessToken&&r.searchParams.set("__lovable_token",t.accessToken),r.toString()}catch(t){return console.error("Error formatting preview URL:",t),e}}function I(e){if(!e)return null;try{return e.replace("http://","ws://").replace("https://","wss://")}catch(e){return console.error("Error converting to WebSocket URL:",e),null}}var x=r(37675),M=r(27613),k=r(77113);let T=e=>(0,l.Ue)()((0,u.n)(()=>({device:"desktop",customScript:!1,_sandboxState:null,_isSandboxStateStale:!1,targetMode:M.i.STATIC,activeMode:M.i.STATIC,visibleMode:M.i.STATIC,currentPath:"/",baseUrls:{static:(0,_.t)({projectId:e}),live:null},error:null,consoleLogs:[],networkRequests:[],rrwebEvents:[],accessToken:void 0}))),j=(0,i.createContext)(null);function P(e){let{children:t}=e,r=(0,p.D)(),[l]=(0,i.useState)(()=>T(r)),u=(0,i.useRef)(null),c=(0,i.useRef)(null),g=(0,i.useMemo)(()=>({live:u,static:c}),[]),f=l(e=>e.targetMode===M.i.LIVE&&"running"===e._sandboxState?M.i.LIVE:M.i.STATIC);(0,i.useEffect)(()=>{l.setState(e=>{e.activeMode=f})},[f,l]);let{data:_}=(0,a.a)({queryKey:["accessToken"],queryFn:async()=>{let e=(0,v.SJ)(),{token:t}=await e.get("/projects/".concat(r,"/auth-token"));return t}});(0,i.useEffect)(()=>{_&&l.setState(e=>{e.accessToken=_})},[_,l]),(0,i.useEffect)(()=>{if("live"!==f){l.setState(e=>{e.visibleMode=M.i.STATIC});return}if("live"===f){let e=setTimeout(()=>{l.setState(e=>{e.visibleMode=M.i.LIVE})},3e3);return()=>clearTimeout(e)}},[f,l]);let S=l(e=>e.targetMode),y=l(e=>e._sandboxState);!function(e){let t=(0,v.SJ)(),r=(0,p.D)(),{setIsBuildErrorOccurredDuringStream:n}=(0,x.Xr)(),a=(0,h.D)(),s=(0,i.useMemo)(()=>{let t=e.enabled&&e.url?new URL(e.url):null;return t?I("".concat(t.protocol,"//").concat(t.host)):null},[e.enabled,e.url]);(0,o.useWebSocket)(s,{protocols:"vite-hmr",share:!0,onMessage:e=>{try{let i=JSON.parse(e.data);if((null==i?void 0:i.type)==="update"){let e=Date.now()-500;a.updateLatestBuildTimestamp(e)}if((null==i?void 0:i.type)==="error"){var s;n(!0),d.logging.info("build_error_from_devserver",{message:null==i?void 0:null===(s=i.err)||void 0===s?void 0:s.message});let e=b.p.safeParse(null==i?void 0:i.err);e.success?(0,m.e)(e.data,r,t):(d.logging.error("error_parsing_devserver_error",{error:e}),(0,m.e)(null==i?void 0:i.err,r,t))}}catch(e){d.logging.error("error_parsing_devserver_error",{error:e})}},onOpen:t=>{var r;null===(r=e.onStatusChange)||void 0===r||r.call(e,"running"),d.logging.debug("devserver_websocket_open")},onClose:t=>{var r;null===(r=e.onStatusChange)||void 0===r||r.call(e,"stopped"),d.logging.debug("devserver_websocket_close")},onError:t=>{var r;null===(r=e.onStatusChange)||void 0===r||r.call(e,"error"),d.logging.error("devserver_websocket_error",{event:t})},shouldReconnect:()=>!0,reconnectInterval:1e3})}({enabled:"live"===S&&"running"===y,url:l(e=>e.baseUrls.live)});let E=e=>{l.setState(t=>{t.device=e})},w=e=>{l.setState(t=>{t.customScript=e})},C=(0,i.useCallback)(()=>{l.setState(e=>{e.targetMode="static",e._sandboxState=null,e._isSandboxStateStale=!0,e.error=null})},[l]),P=(0,i.useCallback)(()=>{l.setState(e=>{("live"!==e.targetMode||"running"!==e._sandboxState||e.error)&&(e.targetMode="live",e._sandboxState="starting",e.error=null)})},[l]),R=(0,i.useCallback)(e=>{l.setState(e=>{e._sandboxState="starting",e.targetMode="live",e.error=null})},[l]),D=(0,i.useCallback)(()=>{l.setState(e=>{e._sandboxState="error",e.error={type:"dev_server",message:"Sorry, we ran into an issue starting the live preview!"}})},[l]),O=(0,i.useCallback)(async()=>{l.setState(e=>{e._sandboxState="starting",e.error=null});try{let e=(0,v.SJ)(),t=await e.post("/projects/".concat(r,"/sandbox/start"),{project_id:r});l.setState(e=>{t.url&&!t.url.endsWith("/")&&(t.url=t.url+"/"),e.baseUrls.live=t.url,e._isSandboxStateStale=!0})}catch(e){D()}},[r,D,l]),A=(0,i.useCallback)(async e=>{let t=l.getState();if("live"===t.targetMode&&(t.error||"error"===t._sandboxState)){R(),l.setState(t=>{t.currentPath=null!=e?e:"/"});return}if(e)l.setState(t=>{t.currentPath=e});else{var r;null===(r=g[t.targetMode].current)||void 0===r||r.reload()}},[g,R,l]),B=(0,i.useCallback)(()=>{l.setState(e=>{e._sandboxState="running",e.error=null})},[l]),V=(0,i.useMemo)(()=>({store:l,setDevice:E,setCustomScript:w,startLiveMode:P,restartLiveMode:R,revertToStaticMode:C,refreshPreview:A,refs:g,buildFullPreviewUrl:W}),[]),G=(0,k.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.latest_commit_sha}),H=l(e=>"live"===e.targetMode&&"starting"===e._sandboxState)&&!!G;(0,i.useEffect)(()=>{H&&O()},[O,H]);let J=(0,s.c3)(18e5);return(0,n.jsxs)(j.Provider,{value:V,children:[(0,n.jsx)(L,{}),(0,n.jsx)(z,{}),"live"===f&&(0,n.jsx)(N,{}),"live"===S&&"error"!==y&&!J&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q,{}),(0,n.jsx)(U,{}),(0,n.jsx)(F,{}),(0,n.jsx)(Z,{onStarted:B,onFatalError:D,onTransientError:R,onInactivityTimeout:C})]}),t]})}function R(){let e=(0,i.useContext)(j);if(!e)throw Error("usePreviewContext must be used within a PreviewProvider");return e}function D(e){let{store:t}=R();return t(e)}function O(){let e=D(e=>e.baseUrls.live);return(0,i.useMemo)(()=>{if(!e)return null;let t=new URL(e);return I("".concat(t.protocol,"//").concat(t.host))},[e])}let A=async e=>{let t;try{if(!(t=await fetch("".concat(e,"_sandbox/dev-server"),{})).ok)return"offline"}catch(e){return"unknown"}try{let e=await t.json();switch(e.state){case"error":case"stopped":case"stopping":case"disabled":case"starting":case"started":case"disabled":return e.state;default:return d.logging.error("unexpected_dev_server_state",{state:e.state}),"unknown"}}catch(e){return d.logging.debug("malformed_dev_server_state_response",{error:e}),"error"}};function L(){let e=R().refs[M.i.STATIC],t=(0,k.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.preview_build_commit_sha}),r=(0,i.useRef)(t);return(0,i.useEffect)(()=>{if(t&&r.current&&t!==r.current){var n;null===(n=e.current)||void 0===n||n.reload()}r.current=t},[t,e]),null}function N(){let e=R().refs[M.i.LIVE];return(0,i.useEffect)(()=>{var t;null===(t=e.current)||void 0===t||t.reload()},[e]),null}function z(){let e=D(e=>e.targetMode),t=R().startLiveMode,r=(0,x.bk)(e=>e.isSendChatMessageMutationPending);return(0,i.useEffect)(()=>{r&&"static"===e&&t()},[r,e,t]),null}function U(){let e=D(e=>e._isSandboxStateStale),t=R().store;return(0,i.useEffect)(()=>{if(e)return;let r=setTimeout(()=>{t.setState(e=>{e._isSandboxStateStale=!0})},"starting"===t.getState()._sandboxState?250:1e4);return()=>clearTimeout(r)},[e,t]),null}function q(){let e=R().store;return(0,i.useEffect)(()=>{e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})},[e]),null}function F(){let e=R().store;return(0,i.useEffect)(()=>{let t=()=>{"visible"===document.visibilityState&&e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[e]),null}function Z(e){let{onStarted:t,onTransientError:r,onFatalError:n,onInactivityTimeout:a}=e,s=D(e=>e._isSandboxStateStale),o=R().store;return(0,i.useEffect)(()=>{if(!s)return;let e=!0;return async function(){try{let s=o.getState().baseUrls.live;if(!s)return;let i=await A(s);if(!e)return;switch(i){case"offline":a();case"error":n();break;case"unknown":case"stopped":r();break;case"started":t()}}finally{if(!e)return;o.setState(e=>{e._isSandboxStateStale=!1})}}(),()=>{e=!1}},[s,n,r,t,a,o]),null}function W(e){let{baseUrl:t,path:r}=e;if(!t)return null;let n=t.endsWith("/")?t.slice(0,-1):t,a=r.startsWith("/")?r:"/".concat(r);return"".concat(n).concat(a)}let B=(0,i.forwardRef)((e,t)=>{let{url:r,useCustomScript:a,accessToken:s,onNavigate:o,onMessage:l,id:u}=e,d=(0,i.useRef)(null),[g,f]=(0,i.useState)(null),[m,p]=(0,i.useState)(!0),v=(0,k.iZ)(e=>e.project),_=v&&!v.is_protected||s,h=g&&_?C(g,{useCustomScript:a,accessToken:s}):null;return(0,i.useImperativeHandle)(t,()=>({reload(){d.current&&(d.current.src=h||d.current.src)}}),[h]),(0,i.useEffect)(()=>{if(d.current&&r&&r!==g&&_){let e=C(r,{useCustomScript:a,accessToken:s});f(r),p(!0),d.current.src=e}},[s,_,g,o,r,a]),(0,i.useEffect)(()=>{let e=e=>{var t;if((null===(t=d.current)||void 0===t?void 0:t.contentWindow)===e.source){if("URL_CHANGED"===e.data.type){if(e.data.url!==g&&(f(e.data.url),e.data.url)){let{pathname:t,search:r,hash:n}=new URL(e.data.url),a=t;r&&(a+=r),n&&(a+=n),o(a)}}else"404"===e.data?p(!1):l(e)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[g,l,o]),(0,n.jsxs)(n.Fragment,{children:[m&&(0,n.jsx)(w,{isLoading:!0}),(0,n.jsx)("iframe",{sandbox:c.h,ref:d,id:u,className:"min-h-full w-full flex-grow",allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;",onLoad:()=>p(!1),onError:()=>{p(!1)}})]})});B.displayName="PreviewIframe";let V=e=>"".concat(e,"-preview-panel");function G(e){let t=V(e);return(0,i.memo)(function(){let r=D(t=>t.activeMode===e),a=D(e=>e.currentPath),[s,o]=(0,i.useState)(a);(0,i.useEffect)(()=>{r&&o(a)},[r,a]);let{fullUrl:l,customScript:u,accessToken:c}=D(t=>({fullUrl:W({baseUrl:t.baseUrls[e],path:s}),customScript:t.customScript,accessToken:t.accessToken})),_=(0,i.useMemo)(()=>l,[l]),{store:y}=R(),E=R().refs[e],w=(0,p.D)(),C=(0,h.D)(),I=(0,v.SJ)(),x=(0,i.useCallback)(e=>{o(e),r&&y.setState(t=>{t.currentPath!==e&&(t.currentPath=e)})},[y,r,o]),M=(0,i.useCallback)(e=>{if(r){var t,n;if(!function(e,t){if("CONSOLE_OUTPUT"!==e.data.type)return;let r=[];if(Array.isArray(e.data.messages))e.data.messages.forEach(t=>{"object"==typeof t&&null!==t&&"string"==typeof t.message&&"string"==typeof t.level?r.push({level:t.level,message:t.message.length>1e4?t.message.slice(0,1e4):t.message,logged_at:t.logged_at||e.data.logged_at||new Date().toISOString()}):d.logging.warn("Received invalid message format within messages array",{msgData:t})});else if("string"==typeof e.data.message&&"string"==typeof e.data.level)r.push({level:e.data.level,message:e.data.message.length>1e4?e.data.message.slice(0,1e4):e.data.message,logged_at:e.data.logged_at||new Date().toISOString()});else{d.logging.warn("Received invalid CONSOLE_OUTPUT data format",{data:e.data});return}t(e=>{r.length>50?e.consoleLogs=r.slice(0,50):e.consoleLogs.push(...r);let t=f(e.consoleLogs);for(;t>1e4||e.consoleLogs.length>50;){let r=e.consoleLogs.shift();if(!r)break;t-=r.message.length}})}(e,y.setState),t=y.setState,"NETWORK_REQUEST"===e.data.type&&t(t=>{let r={...e.data.request};r.responseBody&&r.responseBody.length>1e4&&(r.responseBody=r.responseBody.slice(0,1e4)),r.requestBody&&r.requestBody.length>1e4&&(r.requestBody=r.requestBody.slice(0,1e4)),r.error&&(r.error.message&&r.error.message.length>1e4&&(r.error.message=r.error.message.slice(0,1e4)),r.error.stack&&r.error.stack.length>1e4&&(r.error.stack=r.error.stack.slice(0,1e4))),r.url&&r.url.length>1e4&&(r.url=r.url.slice(0,1e4)),r.statusText&&r.statusText.length>1e4&&(r.statusText=r.statusText.slice(0,1e4)),t.networkRequests.push(r);let n=t.networkRequests.reduce((e,t)=>e+g(t),0);for(;n>1e5||t.networkRequests.length>50;){let e=t.networkRequests.shift();if(!e)break;n-=g(e)}}),n=y.setState,"RRWEB_EVENT"===e.data.type&&n(t=>{for(t.rrwebEvents.push(e.data.event);t.rrwebEvents.length>60;)t.rrwebEvents.shift()}),"RUNTIME_ERROR"===e.data.type||"UNHANDLED_PROMISE_REJECTION"===e.data.type)C.addRuntimeError(e.data.error,e.data.type);else if("FETCH_ERROR"===e.data.type){let t=b.W.safeParse(e.data.error),r=t.success?t.data:e.data.error;t.error&&d.logging.error("error_parsing_fetch_error",{error:t.error,event_data:e.data}),"status"in r&&(null==r?void 0:r.status)>=400&&(null==r?void 0:r.status)<500?(0,m.e)({...r,error_type:S.N.HTTP_CLIENT_ERROR},w,I):(0,m.e)({...r,error_type:S.N.HTTP_SERVER_ERROR},w,I)}}},[r,y,C,w,I]);return(0,n.jsx)(B,{ref:E,id:t,url:_,useCustomScript:u,accessToken:c,onNavigate:x,onMessage:M})})}let H=G("static"),J=G("live")},27613:function(e,t,r){r.d(t,{H:function(){return n},i:function(){return a}});let n={mobile:{name:"mobile",tooltip:"Show desktop preview",icon:"devices"},tablet:{name:"tablet",tooltip:"Show mobile preview",icon:"devices"},desktop:{name:"desktop",tooltip:"Show tablet preview",icon:"devices"}},a={STATIC:"static",LIVE:"live"}},20958:function(e,t,r){r.d(t,{$:function(){return d},C:function(){return g}});var n=r(57437),a=r(92850),s=r(2265),i=r(59625),o=r(2043),l=r(79804);let u=()=>(0,i.Ue)(()=>({repoAccessibilityResponse:void 0})),c=(0,s.createContext)(null),d=e=>{let{children:t,projectId:r}=e,i=(0,s.useRef)(u()),d=(0,s.useMemo)(()=>({store:i.current}),[]),{canEdit:g,isProjectAdmin:f}=(0,o.t)(),{data:m}=(0,a.a)(l.V.repoAccessibility({projectId:r,userProjectPermissions:{admin:f,edit:g}}));return(0,s.useEffect)(()=>{i.current&&i.current.setState(e=>({...e,repoAccessibilityResponse:m}))},[m]),(0,n.jsx)(c.Provider,{value:d,children:t})};function g(){let{store:e}=function(){let e=(0,s.useContext)(c);if(!e)throw Error("useRepoAccessibility must be used within a RepoAccessibilityProvider");return e}();return e(e=>e.repoAccessibilityResponse)}},39484:function(e,t,r){r.d(t,{T:function(){return i}});var n=r(57437),a=r(94508),s=r(22287);let i=e=>{let{text:t,className:r}=e;return(0,n.jsxs)("div",{className:(0,a.cn)("mt-1 flex items-center gap-2 text-sm opacity-70",r),children:[(0,n.jsx)("div",{className:"my-1",children:(0,n.jsx)(s.$,{size:"small"})}),(0,n.jsx)("div",{children:t})]})}},75403:function(e,t,r){r.d(t,{Z:function(){return n}});function n(e,t){if(e.isLoading||!t||!e.supabaseOrganizations)return!1;if(e.noOrganizations)return!0;let r=e.supabaseOrganizations.find(e=>e.id===t.supabase_organization_id);return!r||"failed"===r.status}},32129:function(e,t,r){var n=r(57437),a=r(54365),s=r(27648),i=r(99376);r(2265);var o=r(30438),l=r(48581),u=r(62869),c=r(57346);t.Z=e=>{let{withWrapper:t=!1,className:r,...d}=e,g=(0,i.usePathname)(),f=(0,o.c)(),{isFreePlan:m}=(0,l.tS)();return m&&f?t?(0,n.jsxs)("div",{className:"flex w-full items-center justify-between rounded-md bg-muted px-3 py-2 text-foreground",children:[(0,n.jsxs)("span",{className:"flex items-center gap-1 text-sm",children:[(0,n.jsx)(c.Z,{name:"crown",size:"small"}),"Turn Pro"]}),(0,n.jsx)(u.z,{size:"sm",className:(0,a.Z)("bg-brand-twilight text-brand-twilight-foreground hover:bg-brand-twilight/80",r),asChild:!0,...d,children:(0,n.jsx)(s.default,{href:"".concat(g,"?settings=billing"),children:"Upgrade"})})]}):(0,n.jsx)(u.z,{size:"sm",className:(0,a.Z)("bg-brand-twilight text-brand-twilight-foreground hover:bg-brand-twilight/80",r),asChild:!0,...d,children:(0,n.jsxs)(s.default,{href:"".concat(g,"?settings=billing"),children:[(0,n.jsx)(c.Z,{name:"crown",size:"small"}),"Upgrade"]})}):null}},12339:function(e,t,r){r.d(t,{SP:function(){return u},dr:function(){return l},mQ:function(){return o},nU:function(){return c}});var n=r(57437),a=r(20271),s=r(2265),i=r(94508);let o=a.fC,l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.aV,{ref:t,className:(0,i.cn)("inline-flex h-9 items-center justify-center rounded-lg p-1 text-muted-foreground",r),...s})});l.displayName=a.aV.displayName;let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.xz,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...s})});u.displayName=a.xz.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.VY,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s})});c.displayName=a.VY.displayName},98015:function(e,t,r){r.d(t,{e:function(){return s}});var n=r(21288);r(83079);var a=(0,r(12119).$)("da2287705922bbaa0f34883f5fb3e5ba79e3e1b9");async function s(e,t,r){try{let s=await a(e);if(!s){n.logging.debug("skipping_reporting_error",{error:e,err_message:e.message});return}let i=s.error_type;await r.post("/projects/".concat(t,"/report_error"),{message:null==s?void 0:s.message,error_type:i,meta_data:s})}catch(e){n.logging.error("failed_to_report_intercepted_error",{error:e})}}},30438:function(e,t,r){r.d(t,{c:function(){return l}});var n=r(52558),a=r(61922),s=r(71759);let i=(e,t)=>!!e&&!!t&&t.owner_id===e,o=()=>{let e=(0,s.MD)(),t=(0,s.q$)(t=>e?t.projectWorkspace:null),r=(0,a.i7)(t=>e?null:t.currentWorkspace);return t||r},l=()=>{let{authUser:e}=(0,n.Eu)(),t=o();return i(null==e?void 0:e.uid,t)}},6478:function(e,t,r){r.d(t,{F:function(){return i}});var n=r(57437),a=r(81103),s=r(2265);let i=e=>{let[t,r]=(0,s.useState)(!1),i=(0,s.useRef)(),o=(0,s.useCallback)(e=>{e&&(clearTimeout(i.current),navigator.clipboard.writeText(e),r(!0),i.current=setTimeout(()=>{r(!1)},1e3))},[]);return r=>{let{TriggerComponent:s,textToCopy:i,copiedFeedbackText:l="Copied!"}=r;return(0,n.jsx)(a.pn,{children:(0,n.jsxs)(a.u,{open:t,children:[(0,n.jsx)(a.aJ,{onClick:t=>{(null==e||!e.altKey||t.altKey)&&i&&o(i)},asChild:!0,className:"hello",children:(0,n.jsx)(s,{})}),(0,n.jsx)(a._v,{children:(0,n.jsx)("p",{children:l})})]})})}}},59053:function(e,t,r){r.d(t,{O:function(){return o}});var n=r(2265),a=r(52558),s=r(79358),i=r(61922);let o=e=>{var t,r;let{isAuthenticated:o}=(0,a.Eu)(),u=(0,i.aS)(e=>e.currentWorkspace),c=null!==(t=null==e?void 0:e.projectWorkspace)&&void 0!==t?t:u,d=(0,n.useMemo)(()=>{var e;if(c&&o)return(null!==(e=c.credits_granted)&&void 0!==e?e:0)-c.credits_used>0||c.daily_credits_used<c.daily_credits_limit||(c.billing_period_credits_used||0)<c.billing_period_credits_limit},[c,o]),g=null==c?void 0:c.daily_credits_limit,f=null==c?void 0:c.daily_credits_used,m=null==c?void 0:c.billing_period_credits_limit,p=null==c?void 0:c.billing_period_credits_used,v=void 0!==m&&void 0!==p&&m>0,_=void 0!==g&&void 0!==f&&g>0,h=v?(0,s.u)(m-p,m):"",S=_?(0,s.u)(g-f,g):"";return{dailyCreditLimit:g,dailyCreditsUsed:f,billingPeriodCreditLimit:m,billingPeriodCreditsUsed:p,hasBillingPeriodCredits:v,hasDailyCreditsLimit:_,billingPeriodCreditsFormatted:h,totalCreditsUsedInBillingPeriod:null==c?void 0:c.total_credits_used_in_billing_period,dailyCreditsFormatted:S,bonusCredits:(null==c?void 0:c.credits_granted)!==void 0?c.credits_granted-(null!==(r=c.credits_used)&&void 0!==r?r:0):void 0,areCreditsAvailable:d,billingPeriodEndDate:l(null==c?void 0:c.billing_period_end_date)}},l=e=>e?"string"==typeof e?new Date(e):e.toDate():null},65666:function(e,t,r){r.d(t,{D:function(){return s},v:function(){return a}});var n=r(99376);let a=()=>{let e=(0,n.useParams)().project_id;return e&&"string"==typeof e?e:null},s=()=>{let e=a();if(!e)throw Error("Project ID is required and should always be set here");return e}},2043:function(e,t,r){r.d(t,{t:function(){return c}});var n=r(52558),a=r(60256),s=r(6812),i=r(7455),o=r(77113),l=r(71759),u=r(20984);let c=()=>{let e=(0,o.iZ)(e=>e.project),t=(0,l.hO)(e=>e.projectWorkspace),{authUser:r,isAuthenticated:c}=(0,n.Eu)(),{userData:d}=(0,a.SE)(),g=(0,i.c)(e=>e.accessLevel),f=(0,l.hO)(e=>e.memberships).find(e=>e.user_id===(null==r?void 0:r.uid)),m=(0,l.hO)(e=>e.isLoading),p=(0,s.Q)(e=>e.workspaces).some(t=>t.id===(null==e?void 0:e.workspace_id)),v=t&&t.owner_id===(null==r?void 0:r.uid)||(null==f?void 0:f.role)==="owner",_=(null==f?void 0:f.role)==="admin"||v,h=(null==e?void 0:e.user_id)&&(null==e?void 0:e.user_id)===(null==r?void 0:r.uid)||(null==d?void 0:d.is_admin)||(null==e?void 0:e.user_id)==="claimable"||g===u.u.ADMIN||(null==f?void 0:f.role)==="admin"||v,S=g===u.u.WRITE||(null==f?void 0:f.role)==="member"||h,b=e&&r&&e.user_id===r.uid,y=g===u.u.READ||(null==f?void 0:f.role)==="member"||S||(null==e?void 0:e.visibility)==="public";return{isProjectAdmin:h,canEdit:S,isProjectOwner:b,isWorkspaceOwner:v,isLoading:c&&!r||!e||m&&p,isWorkspaceMember:!!f,isWorkspaceAdmin:_,canRead:y}}},22076:function(e,t,r){r.d(t,{m:function(){return m},D:function(){return p}});var n=r(57437),a=r(2265),s=r(59625),i=r(98015),o=r(65666),l=r(21288),u=r(91115);let c=u.z.object({message:u.z.string().min(1),stack:u.z.string().optional(),filename:u.z.string().optional(),lineno:u.z.number().optional(),colno:u.z.number().optional(),blankScreen:u.z.boolean().optional()});var d=r(49131);let g=()=>(0,s.Ue)(()=>({runtimeErrors:[],latestBuildTimestamp:0})),f=(0,a.createContext)({store:g(),clearDiagnostics:()=>{},updateLatestBuildTimestamp:()=>{},addRuntimeError:()=>{throw Error("ProjectDiagnostics must be used within a ProjectDiagnosticsProvider")}}),m=e=>{let{children:t}=e,r=(0,o.v)();if(!r)throw Error("Project ID is required and should always be set here");let s=(0,a.useRef)();s.current||(s.current=g());let u=(0,d.SJ)(),m={store:s.current,clearDiagnostics:()=>{s.current.setState({runtimeErrors:[]})},addRuntimeError:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RUNTIME_ERROR",n=function(e){let t=c.safeParse(e);return t.success?(t.data.stack||l.logging.warn("diagnostics.runtime_error.stack_missing",{parse_error:t.error,error_data:e}),t.data.filename||l.logging.warn("diagnostics.runtime_error.filename_missing",{parse_error:t.error,error_data:e}),t.data):(l.logging.error("diagnostics.runtime_error.invalid",{parse_error:t.error,error_data:e}),null)}(e);if(!n)return;if(n.blankScreen){(0,i.e)({...n,error_type:"runtime"},r,u).catch(e=>{l.logging.error("error_reporting_runtime_error",{error:e})});return}let a=s.current,o=function(e,t){let r={timestamp:Date.now(),error_type:e,message:t.message||"Unknown error",filename:t.filename||"Unknown file",lineno:t.lineno||0,colno:t.colno||0,stack:t.stack||"Unavailable"};return r.message.length>1e4&&(r.message=r.message.slice(0,1e4)),r.stack.length>1e4&&(r.stack=r.stack.slice(0,1e4)),r}(t,n);a.setState(e=>{let t=[...e.runtimeErrors],r=t.findIndex(e=>0==e.lineno?e.message===o.message:e.filename===o.filename&&e.colno===o.colno&&e.lineno===o.lineno);-1!==r&&t.splice(r,1),t.push(o);let n=t.reduce((e,t)=>e+v(t),0);for(;n>1e5||t.length>50;){let e=t.shift();if(!e)break;n-=v(e)}return{runtimeErrors:t}})},updateLatestBuildTimestamp:e=>{let t=s.current;e>t.getState().latestBuildTimestamp&&t.setState({latestBuildTimestamp:e})}};return(0,n.jsx)(f.Provider,{value:m,children:t})};function p(){return(0,a.useContext)(f)}let v=e=>{var t,r,n,a,s,i;return((null===(t=e.error_type)||void 0===t?void 0:t.length)||0)+((null===(r=e.message)||void 0===r?void 0:r.length)||0)+((null===(n=e.filename)||void 0===n?void 0:n.length)||0)+((null===(a=e.lineno)||void 0===a?void 0:a.toString().length)||0)+((null===(s=e.colno)||void 0===s?void 0:s.toString().length)||0)+((null===(i=e.stack)||void 0===i?void 0:i.length)||0)}},79804:function(e,t,r){r.d(t,{V:function(){return i}});var n=r(52274),a=r(49131),s=r(97318);let i={repoAccessibility:e=>{let{projectId:t,userProjectPermissions:r}=e;return(0,n.C)({queryKey:s.pL.repoAccessibility(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/repo-accessibility")),enabled:r.edit&&!!t})},installations:e=>{let{enabled:t}=e;return(0,n.C)({queryKey:s.pL.installations(),queryFn:()=>(0,a.SJ)().get("/users/github-installations"),enabled:t})}}},33187:function(e,t,r){r.d(t,{W:function(){return l},b:function(){return u}});var n=r(52274),a=r(49131),s=r(21288),i=r(20984),o=r(97318);let l={sourceCode:e=>{let{projectId:t,enabled:r}=e;return(0,n.C)({queryKey:o.iZ.sourceCode(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/source-code")),enabled:r})},feedbackStatus:e=>{let{projectId:t}=e;return(0,n.C)({queryKey:o.iZ.feedbackStatus(t),queryFn:async()=>(0,a.SJ)().get("/user/feedback-status")})},presence:e=>{let{projectId:t,authUser:r,enablePresence:s}=e;return(0,n.C)({queryKey:o.iZ.presence(t),queryFn:()=>r?(0,a.SJ)().post("/projects/".concat(t,"/presence")):Promise.resolve(null),enabled:!!r&&!!t&&s,refetchInterval:6e4,refetchOnWindowFocus:!0,refetchOnMount:!0})},magicCode:e=>{let{projectId:t}=e;return(0,n.C)({queryKey:o.iZ.secretLinkId(t),queryFn:async()=>{let e=(0,a.SJ)(),r=(await e.get("/projects/".concat(t,"/magic-codes"))).magic_codes;return r&&0!==r.length?{id:r[0].id}:{id:null}}})},sharedWithMe:()=>(0,n.C)({queryKey:o.iZ.sharedWithMe(),queryFn:async()=>(0,a.SJ)().get("/user/projects/shared")}),collaborators:e=>{let{projectId:t,projectOwnerId:r}=e,i=(0,a.SJ)();return(0,n.C)({queryKey:o.iZ.collaborators(null!=t?t:""),enabled:!!t&&!!r,refetchInterval:6e4,queryFn:async()=>{try{var e;let n=null!==(e=await i.get("/projects/".concat(t,"/collaborators")))&&void 0!==e?e:[];return u({collaborators:n,projectOwnerId:r})}catch(e){return s.logging.error("Failed to fetch collaborators",{error:e}),[]}}})},communityProjects:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recent",r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return(0,n.C)({queryKey:o.iZ.communityProjects(e,t,r,s),queryFn:async()=>(0,a.Tb)().get("".concat("/projects/community","?limit=").concat(e,"&order_by=").concat(t).concat(r&&"all"!==r?"&category=".concat(r):"").concat(s?"&start_after=".concat(s):"").concat("trending"===t?"&feature_source=trending":""))})},securityWarnings:e=>{let{projectId:t,hasSupabaseConfig:r}=e;return(0,n.C)({queryKey:o.iZ.securityWarnings(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/security-warnings")),enabled:!!t&&r})},analytics:e=>{let{projectId:t,timePeriod:r}=e;return(0,n.C)({queryKey:o.iZ.analytics(t,r),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/analytics"),{params:{startDate:r.startDate,endDate:r.endDate,granularity:r.granularity}})})}};function u(e){let{collaborators:t,projectOwnerId:r}=e;return[...t].sort((e,t)=>{let n=r&&e.id===r,a=r&&t.id===r;return n&&!a?-1:!n&&a?1:e.access_level===i.u.ADMIN&&t.access_level!==i.u.ADMIN?-1:e.access_level!==i.u.ADMIN&&t.access_level===i.u.ADMIN?1:(e.email||"").localeCompare(t.email||"")})}},20984:function(e,t,r){var n,a;r.d(t,{u:function(){return n}}),(a=n||(n={})).ADMIN="admin",a.WRITE="write",a.READ="read",a.NONE="none"},96771:function(e,t,r){var n,a,s,i;r.d(t,{I:function(){return n}}),(s=(a=n||(n={})).type||(a.type={})).AI_UPDATE="ai_update",s.REVERT="revert",s.INITIAL="initial",s.DEVELOPER_UPDATE="developer_update",s.MANUAL_UPDATE="manual_update",(i=a.feedback||(a.feedback={})).POSITIVE="positive",i.NEGATIVE="negative",i.NO_FEEDBACK="no_feedback"},61062:function(e,t,r){var n,a;r.d(t,{N:function(){return n}}),(a=n||(n={})).IMMEDIATE_RUNTIME="immediate_runtime",a.RUNTIME="runtime",a.BUILD="build",a.DEPLOY_SUPABASE_FUNCTIONS="deploy_supabase_functions",a.HTTP_CLIENT_ERROR="http_client_error",a.CORS_ERROR="cors_error",a.HTTP_SERVER_ERROR="http_server_error",a.NO_CODE_CHANGE="no_code_change",a.CODE_DIFF="code_diff",a.FILE_EDITED_WITHOUT_PERMISSION="file_edited_without_permission",a.EXCLUDED_FILE_EDITED="excluded_file_edited",a.SUPABASE_EDGE_FUNCTION_ERROR="supabase_edge_function_error",a.DEPENDENCY_INSTALL="dependency_install",a.SUPABASE_SQL_ERROR="supabase_sql_error",a.SEARCH_REPLACE_FAILED="search_replace_failed",a.SEARCH_REPLACE_MISSING_FILE="search_replace_missing_file",a.CHANGED_MISSING_FILE="changed_missing_file",a.RENAME_FAILED="rename_failed",a.DELETION_FAILED="deletion_failed"},74541:function(e,t,r){var n,a,s;r.d(t,{r:function(){return n}}),(s=(a=n||(n={})).role||(a.role={})).AI="ai",s.USER="user",(a.tag||(a.tag={})).INSTANT_MODE_MESSAGE="instant-mode-message"},72384:function(e,t,r){var n,a;r.d(t,{S:function(){return n}}),(a=n||(n={})).AGENT="agent",a.INSTANT="instant"},79358:function(e,t,r){function n(e){return Number.isInteger(e)?e.toString():e.toFixed(2)}function a(e,t){return"".concat(n(e),"/").concat(n(t))}r.d(t,{H:function(){return n},u:function(){return a}})},7163:function(e,t,r){r.d(t,{W:function(){return l},p:function(){return s}});var n=r(91115),a=r(61062);let s=n.z.object({frame:n.z.string().optional(),id:n.z.string().optional(),loc:n.z.object({file:n.z.string().optional(),line:n.z.number().optional(),column:n.z.number().optional()}).optional(),message:n.z.string(),plugin:n.z.string().optional(),pluginCode:n.z.string().optional(),stack:n.z.string().optional()}).transform(e=>({...e,error_type:a.N.IMMEDIATE_RUNTIME})),i=n.z.object({body:n.z.string(),message:n.z.string(),status:n.z.number(),statusText:n.z.string().optional(),url:n.z.string()}),o=n.z.object({message:n.z.string(),method:n.z.enum(["OPTIONS","GET","POST","PUT","DELETE","PATCH"]),origin:n.z.string().optional(),stack:n.z.string().optional(),url:n.z.string()}),l=n.z.union([i,o])}}]);